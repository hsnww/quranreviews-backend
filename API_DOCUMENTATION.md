# 📚 دليل APIs المصادقة - منصة مراجعة القرآن الكريم

## 🔗 معلومات عامة
- **Base URL**: `https://backend.quranreview.app/api`
- **نوع المصادقة**: Bearer Token (Laravel Sanctum)
- **تنسيق البيانات**: JSON
- **اللغة**: العربية

---

## 🔐 1. تسجيل عضو جديد

### المسار:
```
POST /api/register
```

### البيانات المطلوبة:
```json
{
  "name": "الاسم الكامل",
  "email": "البريد الإلكتروني",
  "password": "كلمة المرور",
  "password_confirmation": "تأكيد كلمة المرور",
  "institution": "الجهة التعليمية (اختياري)"
}
```

### الاستجابة الناجحة (201):
```json
{
  "message": "تم إنشاء الحساب بنجاح",
  "token": "JWT Token",
  "user": {
    "id": 1,
    "name": "الاسم",
    "email": "البريد",
    "institution": "الجهة"
  }
}
```

### الاستجابة عند الخطأ (422):
```json
{
  "message": "بيانات غير صحيحة",
  "errors": {
    "email": ["البريد الإلكتروني مطلوب"],
    "password": ["كلمة المرور يجب أن تكون 8 أحرف على الأقل"]
  }
}
```

---

## 🔑 2. تسجيل الدخول

### المسار:
```
POST /api/login
```

### البيانات المطلوبة:
```json
{
  "email": "البريد الإلكتروني",
  "password": "كلمة المرور"
}
```

### الاستجابة الناجحة (200):
```json
{
  "token": "JWT Token",
  "user": {
    "id": 1,
    "name": "الاسم",
    "email": "البريد"
  }
}
```

### الاستجابة عند الخطأ (401):
```json
{
  "message": "بيانات الدخول غير صحيحة"
}
```

---

## 🚪 3. تسجيل الخروج

### المسار:
```
POST /api/logout
```

### الرؤوس المطلوبة:
```
Authorization: Bearer {token}
```

### الاستجابة الناجحة (200):
```json
{
  "message": "تم تسجيل الخروج بنجاح"
}
```

---

## 📧 4. طلب إعادة تعيين كلمة المرور

### المسار:
```
POST /api/forgot-password
```

### البيانات المطلوبة:
```json
{
  "email": "البريد الإلكتروني"
}
```

### الاستجابة الناجحة (200):
```json
{
  "message": "تم إرسال رابط إعادة تعيين كلمة المرور"
}
```

### الاستجابة عند الخطأ (422):
```json
{
  "message": "البريد الإلكتروني غير صحيح",
  "errors": {
    "email": ["البريد الإلكتروني غير موجود"]
  }
}
```

---

## 🔄 5. إعادة تعيين كلمة المرور

### المسار:
```
POST /api/reset-password
```

### البيانات المطلوبة:
```json
{
  "token": "توكن إعادة التعيين",
  "email": "البريد الإلكتروني",
  "password": "كلمة المرور الجديدة",
  "password_confirmation": "تأكيد كلمة المرور الجديدة"
}
```

### الاستجابة الناجحة (200):
```json
{
  "message": "تم إعادة تعيين كلمة المرور بنجاح"
}
```

### الاستجابة عند الخطأ (400):
```json
{
  "message": "التوكن غير صحيح أو منتهي الصلاحية"
}
```

---

## 👤 6. جلب بيانات المستخدم الحالي

### المسار:
```
GET /api/user
```

### الرؤوس المطلوبة:
```
Authorization: Bearer {token}
```

### الاستجابة الناجحة (200):
```json
{
  "id": 1,
  "name": "الاسم",
  "email": "البريد",
  "institution": "الجهة",
  "memorized_count": 15
}
```

---

## 📧 7. إعدادات البريد الإلكتروني

### عند طلب إعادة تعيين كلمة المرور:
- يتم إرسال بريد إلكتروني يحتوي على رابط إعادة التعيين
- الرابط صالح لمدة 60 دقيقة
- الرابط يحتوي على التوكن والبريد الإلكتروني
- تنسيق البريد: HTML مع تصميم جميل باللغة العربية

### مثال على الرابط المرسل:
```
https://quranreview.app/reset-password?token=abc123&email=user@example.com
```

---

## ⚠️ 8. رموز الحالة (Status Codes)

| الرمز | المعنى | الوصف |
|-------|--------|--------|
| 200 | OK | الطلب نجح |
| 201 | Created | تم إنشاء المورد بنجاح |
| 400 | Bad Request | طلب غير صحيح |
| 401 | Unauthorized | غير مصرح بالوصول |
| 422 | Unprocessable Entity | بيانات غير صحيحة |
| 500 | Internal Server Error | خطأ في الخادم |

---

## 🔧 9. نصائح للتطوير

### إدارة التوكن:
- احفظ التوكن في `localStorage` أو `sessionStorage`
- أضف التوكن في رأس `Authorization: Bearer {token}`
- احذف التوكن عند تسجيل الخروج

### معالجة الأخطاء:
- تحقق من رمز الحالة قبل معالجة الاستجابة
- اعرض رسائل الخطأ للمستخدم باللغة العربية
- تعامل مع انتهاء صلاحية التوكن

### التحقق من البيانات:
- تأكد من صحة البريد الإلكتروني
- كلمة المرور يجب أن تكون 8 أحرف على الأقل
- تأكيد كلمة المرور يجب أن يطابق كلمة المرور

### الأمان:
- استخدم HTTPS في الإنتاج
- لا تحفظ كلمات المرور في المتصفح
- احذف التوكن عند تسجيل الخروج

---

## 🌐 10. متغيرات البيئة المطلوبة

```env
# البيئة المحلية
NEXT_PUBLIC_API_URL=http://localhost:8000/api

# البيئة الإنتاج
NEXT_PUBLIC_API_URL=https://backend.quranreview.app/api
```

---

## ✅ 11. قائمة APIs المتاحة

| المسار | الطريقة | الوصف | مصادقة مطلوبة |
|--------|---------|--------|----------------|
| `/api/register` | POST | تسجيل عضو جديد | ❌ |
| `/api/login` | POST | تسجيل دخول | ❌ |
| `/api/logout` | POST | تسجيل خروج | ✅ |
| `/api/forgot-password` | POST | طلب إعادة تعيين | ❌ |
| `/api/reset-password` | POST | إعادة تعيين | ❌ |
| `/api/user` | GET | بيانات المستخدم | ✅ |

---

## 📞 للدعم الفني
- البريد الإلكتروني: support@quranreview.app
- الوثائق: https://docs.quranreview.app

**تاريخ آخر تحديث:** 10 سبتمبر 2025

